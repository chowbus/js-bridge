!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).NativeBridge=t()}(this,function(){"use strict";class e{constructor(e="NativeBridge"){this.prefix=e,this.enabled=!0}log(e,t){this.enabled&&"undefined"!=typeof console&&console.log&&console.log(`[${this.prefix}] ${e}`,t||"")}warn(e,t){this.enabled&&"undefined"!=typeof console&&console.warn&&console.warn(`[${this.prefix}] ⚠️ ${e}`,t||"")}error(e,t){this.enabled&&"undefined"!=typeof console&&console.error&&console.error(`[${this.prefix}] ❌ ${e}`,t||"")}setEnabled(e){this.enabled=e}}class t{static detect(){if("undefined"==typeof window)return"node";const e=navigator.userAgent.toLowerCase();return void 0!==window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.NativeBridge?"ios":void 0!==window.AndroidBridge?"android":/iphone|ipad|ipod/.test(e)?"ios-browser":/android/.test(e)?"android-browser":"browser"}static isNative(e){return"ios"===e||"android"===e}static isBrowser(e){return e.includes("browser")||"browser"===e}static getPlatformInfo(e){return{type:e,isNative:this.isNative(e),isBrowser:this.isBrowser(e),userAgent:"undefined"!=typeof navigator?navigator.userAgent:"N/A"}}}class i{constructor(){this.callbacks={},this.callbackId=0,"undefined"==typeof window||window.__nativeBridgeCallbacks||(window.__nativeBridgeCallbacks={})}generateId(){const e=Date.now(),t=Math.random().toString(36).substr(2,9);return`cb_${e}_${++this.callbackId}_${t}`}register(e,t,i=1e4){"undefined"!=typeof window&&(window.__nativeBridgeCallbacks[e]=t,i>0&&setTimeout(()=>{this.remove(e)},i))}execute(e,t){if("undefined"==typeof window)return!1;const i=window.__nativeBridgeCallbacks[e];return"function"==typeof i&&(i(t),!0)}remove(e){"undefined"!=typeof window&&window.__nativeBridgeCallbacks[e]&&delete window.__nativeBridgeCallbacks[e]}clear(){"undefined"!=typeof window&&Object.keys(window.__nativeBridgeCallbacks).forEach(e=>{delete window.__nativeBridgeCallbacks[e]})}count(){return"undefined"==typeof window?0:Object.keys(window.__nativeBridgeCallbacks).length}}class r{constructor(e){this.logger=e,this.available=this.checkAvailability()}checkAvailability(){return"undefined"!=typeof window&&void 0!==window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.NativeBridge}postMessage(e){if(!this.available)throw new Error("iOS WebKit Bridge not available");try{window.webkit.messageHandlers.NativeBridge.postMessage(e),this.logger.log("iOS message sent",e)}catch(e){throw this.logger.error("iOS message send failed",e),e}}isAvailable(){return this.available}}class s{constructor(e){this.logger=e,this.available=this.checkAvailability()}checkAvailability(){return"undefined"!=typeof window&&void 0!==window.AndroidBridge}postMessage(e){if(!this.available)throw new Error("Android Bridge not available");try{const t=JSON.stringify(e);window.AndroidBridge.postMessage(t),this.logger.log("Android message sent",e)}catch(e){throw this.logger.error("Android message send failed",e),e}}isAvailable(){return this.available}}const a=new class{constructor(){this.logger=new e("NativeBridge"),this.callbackManager=new i,this.eventHandlers={},this.initialized=!1,this.platform=null,this.adapter=null,this.init()}init(){this.initialized||(this.platform=t.detect(),this.createAdapter(),this.initialized=!0,this.logger.log("Initialized",{platform:this.platform,isNative:this.isNative()}))}createAdapter(){switch(this.platform){case"ios":this.adapter=new r(this.logger);break;case"android":this.adapter=new s(this.logger);break;default:this.adapter=null}}call(e,t={}){return new Promise((i,r)=>{if(!this.isNative())return this.logger.warn(`Not in native environment: ${e}`),void setTimeout(()=>{i({mock:!0,method:e,params:t})},100);const s=this.callbackManager.generateId();this.logger.log(`Call: ${e}`,{params:t,callbackId:s}),this.callbackManager.register(s,t=>{this.logger.log(`Callback: ${e}`,t),"object"==typeof t?!0===t.success?i(t.data||{}):!1===t.success?r(new Error(t.error||"Unknown error")):i(t):i(t),this.callbackManager.remove(s)},1e4);try{this.adapter.postMessage({method:e,params:t,callbackId:s})}catch(t){this.logger.error(`Send failed: ${e}`,t),this.callbackManager.remove(s),r(t)}})}on(e,t){"function"==typeof t?(this.eventHandlers[e]||(this.eventHandlers[e]=[]),this.eventHandlers[e].push(t),this.logger.log(`Listen: ${e}`)):this.logger.error("Handler must be a function")}off(e,t){this.eventHandlers[e]&&(t?this.eventHandlers[e]=this.eventHandlers[e].filter(e=>e!==t):delete this.eventHandlers[e],this.logger.log(`Unlisten: ${e}`))}emit(e,t){const i=this.eventHandlers[e];i&&0!==i.length?(this.logger.log(`Emit: ${e}`,t),i.forEach(i=>{try{i(t)}catch(t){this.logger.error(`Event handler error: ${e}`,t)}})):this.logger.warn(`No listeners for: ${e}`)}send(e,t={}){if(this.isNative()){this.logger.log(`Send: ${e}`,t);try{this.adapter.postMessage({method:e,params:t,callbackId:null})}catch(t){this.logger.error(`Send failed: ${e}`,t)}}else this.logger.warn(`Not in native environment: ${e}`)}isNative(){return t.isNative(this.platform)}getPlatform(){return t.getPlatformInfo(this.platform)}setLogEnabled(e){this.logger.setEnabled(e)}destroy(){this.callbackManager.clear(),this.eventHandlers={},this.initialized=!1,this.logger.log("Destroyed")}};return"undefined"!=typeof window&&(window.NativeBridge=a),a});
